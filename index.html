<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global SM Companies Status</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: #f5f5f5;
overflow: hidden;
}

.container {
display: flex;
height: 100vh;
}

.map-section {
flex: 1;
display: flex;
flex-direction: column;
}

/* --- ì‚¬ì´ë“œë°”: ì›ë³¸ ë””ìì¸ ìœ ì§€ + ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ --- */
.sidebar {
width: 380px;
min-width: 380px;
background: white;
overflow-y: auto;
box-shadow: -2px 0 10px rgba(0,0,0,0.1);
transition: all 0.3s ease; /* ìŠ¬ë¼ì´ë“œ íš¨ê³¼ */
position: relative;
overflow-x: visible; /* ë²„íŠ¼ì„ ì‚¬ì´ë“œë°” ë°–ì— í‘œì‹œí•˜ê¸° ìœ„í•´ í•„ìˆ˜ */
}

/* ì ‘í˜”ì„ ë•Œ ì‚¬ì´ë“œë°” ìƒíƒœ */
.sidebar.collapsed {
width: 0 !important;
min-width: 0 !important;
}

/* --- ìŠ¬ë¼ì´ë“œ ë²„íŠ¼: ì•„ì£¼ í¬ê³  í™•ì‹¤í•˜ê²Œ ë³´ì´ë„ë¡ ë””ìì¸ --- */
#toggle-btn {
position: absolute;
left: -40px; /* ì‚¬ì´ë“œë°” ì™¼ìª½ ë°–ìœ¼ë¡œ ëŒì¶œ */
top: 50%;
transform: translateY(-50%);
width: 40px;
height: 100px;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
border: none;
border-radius: 12px 0 0 12px;
cursor: pointer;
box-shadow: -5px 0 15px rgba(0,0,0,0.3);
z-index: 2000;
font-size: 20px;
font-weight: bold;
display: flex;
align-items: center;
justify-content: center;
}

#header {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 20px;
}

#header h1 {
font-size: 20px;
font-weight: 600;
margin: 0 0 5px 0;
}

#header .subtitle {
font-size: 12px;
opacity: 0.9;
}

#map {
flex: 1;
width: 100%;
}

.stats-section {
padding: 20px;
border-bottom: 1px solid #eee;
}

.stats-section h3 {
font-size: 13px;
color: #667eea;
margin-bottom: 12px;
text-transform: uppercase;
letter-spacing: 1px;
font-weight: 600;
}

.stat-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 10px 12px;
margin-bottom: 6px;
border-radius: 8px;
background: #f8f9fa;
cursor: pointer;
transition: all 0.3s ease;
}

.stat-item:hover {
background: #e9ecef;
transform: translateX(-5px);
}

.stat-label {
display: flex;
align-items: center;
gap: 8px;
font-size: 13px;
color: #333;
}

.stat-color {
width: 14px;
height: 14px;
border-radius: 50%;
}

.stat-number {
font-size: 18px;
font-weight: bold;
color: #667eea;
}

.stat-detail {
font-size: 11px;
color: #666;
margin-top: 2px;
}

/* í•˜ìœ„ ëª©ë¡ */
.sub-items {
margin-left: 22px;
margin-top: 5px;
display: none;
}

.sub-items.active {
display: block;
}

.sub-item {
padding: 7px 10px;
margin-bottom: 4px;
border-radius: 6px;
background: #fff;
border: 1px solid #e9ecef;
font-size: 11px;
cursor: pointer;
transition: all 0.2s ease;
}

.sub-item:hover {
background: #f8f9fa;
border-color: #667eea;
transform: translateX(-3px);
}

.sub-item-name {
font-weight: 500;
color: #333;
margin-bottom: 2px;
}

.sub-item-detail {
font-size: 10px;
color: #666;
}

.expand-icon {
margin-left: 5px;
font-size: 9px;
transition: transform 0.3s ease;
}

.expand-icon.expanded {
transform: rotate(180deg);
}

/* Capacity í‘œì‹œ */
.capacity-box {
background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
padding: 12px;
border-radius: 8px;
margin-bottom: 8px;
}

.capacity-title {
font-size: 11px;
color: #667eea;
font-weight: 600;
margin-bottom: 5px;
}

.capacity-value {
font-size: 20px;
font-weight: bold;
color: #333;
}

.capacity-unit {
font-size: 12px;
color: #666;
margin-left: 5px;
}

.legend-section {
padding: 20px;
}

.legend-section h3 {
font-size: 13px;
color: #667eea;
margin-bottom: 12px;
text-transform: uppercase;
letter-spacing: 1px;
font-weight: 600;
}

.legend-item {
display: flex;
align-items: center;
margin-bottom: 8px;
font-size: 12px;
padding: 6px 10px;
border-radius: 6px;
cursor: pointer;
transition: all 0.2s ease;
}

.legend-item:hover {
background: #f8f9fa;
}

.legend-marker {
width: 18px;
height: 18px;
border-radius: 50%;
margin-right: 8px;
}

.size-legend {
margin-top: 15px;
padding-top: 15px;
border-top: 1px solid #eee;
}

.size-item {
display: flex;
align-items: center;
margin-bottom: 6px;
font-size: 11px;
}

.size-circle {
border-radius: 50%;
background: #667eea;
margin-right: 8px;
}

/* ë§ˆì»¤ ìŠ¤íƒ€ì¼ */
.custom-marker {
background: transparent;
border: none;
}

.custom-marker svg {
filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
transition: all 0.3s ease;
}

.custom-marker:hover svg {
transform: scale(1.3);
}

@keyframes pulse {
0%, 100% { opacity: 1; }
50% { opacity: 0.4; }
}

.pulse-marker {
animation: pulse 2s ease-in-out infinite;
}

.leaflet-popup-content-wrapper {
border-radius: 12px;
box-shadow: 0 5px 20px rgba(0,0,0,0.2);
}

.leaflet-popup-content {
margin: 15px;
font-size: 13px;
line-height: 1.6;
}

.company-name {
font-weight: bold;
color: #667eea;
font-size: 14px;
margin-bottom: 8px;
}

.label-marker {
background: rgba(102, 126, 234, 0.9);
color: white;
padding: 4px 10px;
border-radius: 4px;
font-size: 12px;
font-weight: 500;
white-space: nowrap;
box-shadow: 0 2px 6px rgba(0,0,0,0.3);
border: none;
}
</style>
</head>
<body>
<div class="container">
<div class="map-section">
<div id="header">
<h1>Global SM Companies Status</h1>
<div class="subtitle">Made by LAM</div>
</div>
<div id="map"></div>
</div>

<div class="sidebar">
<button id="toggle-btn" onclick="toggleSidebar()">â–¶</button>

<div class="stats-section">
<h3>ğŸ“Š Statistics</h3>
<div class="stat-item" onclick="resetMapView()">
<span class="stat-label">Total Companies</span>
<span class="stat-number" id="total-count">0</span>
</div>

<div class="capacity-box">
<div class="capacity-title">Total Capacity</div>
<div>
<span class="capacity-value" id="total-capacity">0</span>
<span class="capacity-unit">kt/year</span>
</div>
</div>

<div class="capacity-box" style="background: #ff6b6b15;">
<div class="capacity-title">Current Loss Rate (Feb)</div>
<div>
<span class="capacity-value" id="current-loss-rate" style="color: #ff6b6b;">0</span>
<span class="capacity-unit">%</span>
</div>
<div class="stat-detail" id="current-loss-detail">Loss: 0 kt</div>
</div>

<div class="capacity-box" style="background: #4169e115;">
<div class="capacity-title">Total Loss Rate (2026)</div>
<div>
<span class="capacity-value" id="total-loss-rate" style="color: #4169e1;">0</span>
<span class="capacity-unit">%</span>
</div>
<div class="stat-detail" id="total-loss-detail">Loss: 0 kt</div>
</div>

<div class="stat-item" onclick="toggleSubItems('current')">
<span class="stat-label">
âš« Current Maintenance
<span class="expand-icon" id="current-icon">â–¼</span>
</span>
<span class="stat-number" id="current-maintenance-count">0</span>
</div>
<div class="sub-items" id="current-sub"></div>

<div class="stat-item" onclick="toggleSubItems('future')">
<span class="stat-label">
ğŸ”µ Future Maintenance
<span class="expand-icon" id="future-icon">â–¼</span>
</span>
<span class="stat-number" id="future-maintenance-count">0</span>
</div>
<div class="sub-items" id="future-sub"></div>
</div>

<div class="stats-section">
<h3>ğŸŒ Regions</h3>

<div class="stat-item" onclick="toggleSubItems('asia')">
<div style="flex: 1;">
<div class="stat-label">
<span class="stat-color" style="background-color: #FF6B6B;"></span>
Asia
<span class="expand-icon" id="asia-icon">â–¼</span>
</div>
<div class="stat-detail"><span id="asia-capacity">0 kt/year</span> (<span id="asia-pct">0%</span>)</div>
</div>
<span class="stat-number" id="asia-count">0</span>
</div>
<div class="sub-items" id="asia-sub">
<div class="sub-item" onclick="flyToCountry('china')">
<div class="sub-item-name">ğŸ‡¨ğŸ‡³ China (<span id="china-count">0</span>)</div>
<div class="sub-item-detail"><span id="china-capacity">0 kt/year</span> (<span id="china-pct">0%</span>)</div>
</div>
<div class="sub-item" onclick="flyToCountry('japan')">
<div class="sub-item-name">ğŸ‡¯ğŸ‡µ Japan (<span id="japan-count">0</span>)</div>
<div class="sub-item-detail"><span id="japan-capacity">0 kt/year</span> (<span id="japan-pct">0%</span>)</div>
</div>
<div class="sub-item" onclick="flyToCountry('korea')">
<div class="sub-item-name">ğŸ‡°ğŸ‡· Korea (<span id="korea-count">0</span>)</div>
<div class="sub-item-detail"><span id="korea-capacity">0 kt/year</span> (<span id="korea-pct">0%</span>)</div>
</div>
<div class="sub-item" onclick="flyToCountry('taiwan')">
<div class="sub-item-name">ğŸ‡¹ğŸ‡¼ Taiwan (<span id="taiwan-count">0</span>)</div>
<div class="sub-item-detail"><span id="taiwan-capacity">0 kt/year</span> (<span id="taiwan-pct">0%</span>)</div>
</div>
<div class="sub-item" onclick="flyToCountry('sea')">
<div class="sub-item-name">ğŸŒ SEA (<span id="sea-count">0</span>)</div>
<div class="sub-item-detail"><span id="sea-capacity">0 kt/year</span> (<span id="sea-pct">0%</span>)</div>
</div>
</div>

<div class="stat-item" onclick="flyToRegion('americas')">
<div style="flex: 1;">
<div class="stat-label">
<span class="stat-color" style="background-color: #95E1D3;"></span>
Americas
</div>
<div class="stat-detail"><span id="americas-capacity">0 kt/year</span> (<span id="americas-pct">0%</span>)</div>
</div>
<span class="stat-number" id="americas-count">0</span>
</div>

<div class="stat-item" onclick="toggleSubItems('europe')">
<div style="flex: 1;">
<div class="stat-label">
<span class="stat-color" style="background-color: #4ECDC4;"></span>
Europe
<span class="expand-icon" id="europe-icon">â–¼</span>
</div>
<div class="stat-detail"><span id="europe-capacity">0 kt/year</span> (<span id="europe-pct">0%</span>)</div>
</div>
<span class="stat-number" id="europe-count">0</span>
</div>
<div class="sub-items" id="europe-sub"></div>

<div class="stat-item" onclick="flyToRegion('middleeast')">
<div style="flex: 1;">
<div class="stat-label">
<span class="stat-color" style="background-color: #FFB84D;"></span>
Middle East
</div>
<div class="stat-detail"><span id="me-capacity">0 kt/year</span> (<span id="me-pct">0%</span>)</div>
</div>
<span class="stat-number" id="me-count">0</span>
</div>

<div class="stat-item" onclick="flyToRegion('russia')">
<div style="flex: 1;">
<div class="stat-label">
<span class="stat-color" style="background-color: #C7CEEA;"></span>
Russia
</div>
<div class="stat-detail"><span id="russia-capacity">0 kt/year</span> (<span id="russia-pct">0%</span>)</div>
</div>
<span class="stat-number" id="russia-count">0</span>
</div>
</div>

<div class="legend-section">
<h3>ğŸ“ Status</h3>
<div class="legend-item" onclick="showMaintenanceMarkers('current')">
<div class="legend-marker" style="background-color: black;"></div>
<span>Current Maintenance</span>
</div>
<div class="legend-item" onclick="showMaintenanceMarkers('future')">
<div class="legend-marker" style="background-color: #4169E1; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
<span>Future Maintenance</span>
</div>

<div class="size-legend">
<h3 style="margin-bottom: 8px;">ğŸ“ Capacity</h3>
<div class="size-item">
<div class="size-circle" style="width: 10px; height: 10px;"></div>
<span>0-100 kt</span>
</div>
<div class="size-item">
<div class="size-circle" style="width: 14px; height: 14px;"></div>
<span>100-300 kt</span>
</div>
<div class="size-item">
<div class="size-circle" style="width: 18px; height: 18px;"></div>
<span>300-500 kt</span>
</div>
<div class="size-item">
<div class="size-circle" style="width: 24px; height: 24px;"></div>
<span>500-700 kt</span>
</div>
<div class="size-item">
<div class="size-circle" style="width: 30px; height: 30px;"></div>
<span>700+ kt</span>
</div>
</div>
</div>
</div>
</div>

<script>
let map;
let allMarkers = [];
let clusters = [];
let currentMaintenanceList = [];
let futureMaintenanceList = [];

// --- ìŠ¬ë¼ì´ë“œ í† ê¸€ í•¨ìˆ˜ (ì§€ë„ê°€ ê¹¨ì§€ì§€ ì•Šë„ë¡ ë¦¬ì‚¬ì´ì¦ˆ íŠ¸ë¦¬ê±° í¬í•¨) ---
function toggleSidebar() {
const sidebar = document.querySelector('.sidebar');
const btn = document.getElementById('toggle-btn');
sidebar.classList.toggle('collapsed');
btn.innerText = sidebar.classList.contains('collapsed') ? 'â—€' : 'â–¶';

setTimeout(() => {
map.invalidateSize();
}, 350);
}

const monthDays = {
'1ì›”': 31, '2ì›”': 28, '3ì›”': 31, '4ì›”': 30, '5ì›”': 31, '6ì›”': 30,
'7ì›”': 31, '8ì›”': 31, '9ì›”': 30, '10ì›”': 31, '11ì›”': 30, '12ì›”': 31
};

fetch('data.json')
.then(response => response.json())
.then(data => {
clusters = data.clusters;
initMap();
})
.catch(error => {
console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
alert('ì§€ë„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
});

function initMap() {
map = L.map('map');

function getRegionColor(country) {
const regionMap = {
'CHINA (MAINLAND)': '#FF6B6B', 'KOREA, SOUTH': '#FF6B6B', 'JAPAN': '#FF6B6B',
'TAIWAN': '#FF6B6B', 'SINGAPORE': '#FF6B6B', 'INDONESIA': '#FF6B6B', 'THAILAND': '#FF6B6B',
'USA': '#95E1D3', 'CANADA': '#95E1D3', 'BRAZIL': '#95E1D3',
'BELGIUM': '#4ECDC4', 'FRANCE': '#4ECDC4', 'GERMANY': '#4ECDC4',
'ITALY': '#4ECDC4', 'NETHERLANDS': '#4ECDC4', 'SPAIN': '#4ECDC4',
'POLAND': '#4ECDC4', 'CZECH REPUBLIC': '#4ECDC4',
'SAUDI ARABIA': '#FFB84D', 'KUWAIT': '#FFB84D', 'IRAN': '#FFB84D',
'RUSSIA': '#C7CEEA'
};
return regionMap[country] || '#95a5a6';
}

L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
maxZoom: 19,
attribution: 'Â© OpenStreetMap Â© CARTO'
}).addTo(map);

let stats = {
totalCompanies: 0,
totalCapacity: 0,
totalLoss: 0,
currentLoss: 0,
futureLoss: 0,
currentMaintCount: 0,
futureMaintCount: 0,
regions: {
asia: { count: 0, capacity: 0 },
americas: { count: 0, capacity: 0 },
europe: { count: 0, capacity: 0 },
middleeast: { count: 0, capacity: 0 },
russia: { count: 0, capacity: 0 }
},
countries: {
china: { count: 0, capacity: 0 },
japan: { count: 0, capacity: 0 },
korea: { count: 0, capacity: 0 },
taiwan: { count: 0, capacity: 0 },
sea: { count: 0, capacity: 0 }
},
europeCountries: {}
};

clusters.forEach(cluster => {
cluster.companies.forEach(company => {
stats.totalCompanies++;
const cap = company.capacity === 'N/A' || !company.capacity ? 0 : parseInt(company.capacity);
stats.totalCapacity += cap;
const country = company.country;

if (['CHINA (MAINLAND)', 'KOREA, SOUTH', 'JAPAN', 'TAIWAN', 'SINGAPORE', 'INDONESIA', 'THAILAND'].includes(country)) {
stats.regions.asia.count++;
stats.regions.asia.capacity += cap;
if (country === 'CHINA (MAINLAND)') { stats.countries.china.count++; stats.countries.china.capacity += cap; }
else if (country === 'JAPAN') { stats.countries.japan.count++; stats.countries.japan.capacity += cap; }
else if (country === 'KOREA, SOUTH') { stats.countries.korea.count++; stats.countries.korea.capacity += cap; }
else if (country === 'TAIWAN') { stats.countries.taiwan.count++; stats.countries.taiwan.capacity += cap; }
else { stats.countries.sea.count++; stats.countries.sea.capacity += cap; }
}
else if (['USA', 'CANADA', 'BRAZIL'].includes(country)) { stats.regions.americas.count++; stats.regions.americas.capacity += cap; }
else if (['BELGIUM', 'FRANCE', 'GERMANY', 'ITALY', 'NETHERLANDS', 'SPAIN', 'POLAND', 'CZECH REPUBLIC'].includes(country)) {
stats.regions.europe.count++; stats.regions.europe.capacity += cap;
stats.europeCountries[country] = (stats.europeCountries[country] || 0) + cap;
}
else if (['SAUDI ARABIA', 'KUWAIT', 'IRAN'].includes(country)) { stats.regions.middleeast.count++; stats.regions.middleeast.capacity += cap; }
else if (country === 'RUSSIA') { stats.regions.russia.count++; stats.regions.russia.capacity += cap; }

const maintenance = company.maintenance || 'ì—†ìŒ';
if (maintenance !== 'ì—†ìŒ') {
const months = [];
for (let m in monthDays) { if (maintenance.includes(m)) months.push(m); }
if (months.length > 0) {
const totalDays = months.reduce((sum, m) => sum + monthDays[m], 0);
const loss = (cap / 365) * totalDays;
stats.totalLoss += loss;
if (company.is_current_maintenance) stats.currentLoss += loss;
if (company.has_future_maintenance) stats.futureLoss += loss;
}
}

if (company.is_current_maintenance) {
stats.currentMaintCount++;
currentMaintenanceList.push({ company: company.company, location: cluster.location, lat: cluster.lat, lng: cluster.lng, capacity: cap });
}
if (company.has_future_maintenance) {
stats.futureMaintCount++;
futureMaintenanceList.push({ company: company.company, location: cluster.location, lat: cluster.lat, lng: cluster.lng, capacity: cap, maintenance: company.maintenance });
}
});

let color = getRegionColor(cluster.country);
let shape = 'pin';
const isCurrentMaintenance = cluster.companies.some(c => c.is_current_maintenance);
const isFutureMaintenance = cluster.companies.some(c => c.has_future_maintenance);
if (isCurrentMaintenance) color = 'black';
if (isFutureMaintenance) { shape = 'triangle'; color = '#4169E1'; }

const avgCapacity = cluster.companies.reduce((sum, c) => sum + (parseInt(c.capacity) || 0), 0) / cluster.companies.length;
let markerSize = 18;
if (avgCapacity < 100) markerSize = 10;
else if (avgCapacity < 300) markerSize = 14;
else if (avgCapacity < 500) markerSize = 18;
else if (avgCapacity < 700) markerSize = 24;
else markerSize = 30;

const pinHeight = markerSize * 1.3;
let iconHtml = shape === 'triangle'
? `<svg width="${markerSize}" height="${pinHeight}" viewBox="0 0 100 120"><polygon points="50,10 10,110 90,110" fill="${color}" stroke="white" stroke-width="3"/></svg>`
: `<svg width="${markerSize}" height="${pinHeight}" viewBox="0 0 100 120"><path d="M50,10 C30,10 15,25 15,45 C15,65 50,110 50,110 C50,110 85,65 85,45 C85,25 70,10 50,10 Z" fill="${color}" stroke="white" stroke-width="3"/></svg>`;

const customIcon = L.divIcon({
className: 'custom-marker' + (isFutureMaintenance ? ' pulse-marker' : ''),
html: iconHtml, iconSize: [markerSize, pinHeight], iconAnchor: [markerSize/2, pinHeight], popupAnchor: [0, -pinHeight]
});

const marker = L.marker([cluster.lat, cluster.lng], { icon: customIcon });
let popupContent = `<div style="max-width: 300px;"><div class="company-name">${cluster.location}</div>`;
cluster.companies.forEach(c => {
popupContent += `<div style="border-top: 1px solid #eee; padding-top: 8px; margin-top: 8px;">
<div style="font-weight: 500;">${c.company}</div>
<div style="font-size: 12px; color: #666;">Capacity: ${c.capacity} kt | Maintenance: ${c.maintenance}</div></div>`;
});
popupContent += `</div>`;
marker.bindPopup(popupContent);
marker.addTo(map);
allMarkers.push(marker);
});

document.getElementById('total-count').textContent = stats.totalCompanies;
document.getElementById('total-capacity').textContent = stats.totalCapacity.toLocaleString();
document.getElementById('current-loss-rate').textContent = (stats.currentLoss / stats.totalCapacity * 100).toFixed(2);
document.getElementById('current-loss-detail').textContent = `Loss: ${Math.round(stats.currentLoss).toLocaleString()} kt`;
document.getElementById('total-loss-rate').textContent = (stats.totalLoss / stats.totalCapacity * 100).toFixed(2);
document.getElementById('total-loss-detail').textContent = `Loss: ${Math.round(stats.totalLoss).toLocaleString()} kt`;
document.getElementById('current-maintenance-count').textContent = stats.currentMaintCount;
document.getElementById('future-maintenance-count').textContent = stats.futureMaintCount;

// ì§€ì—­ë³„ ì—…ë°ì´íŠ¸ ë¡œì§ (ìƒëµ ì—†ì´ ì›í˜• ìœ ì§€)
document.getElementById('asia-count').textContent = stats.regions.asia.count;
document.getElementById('asia-capacity').textContent = `${stats.regions.asia.capacity.toLocaleString()} kt/year`;
document.getElementById('asia-pct').textContent = `${(stats.regions.asia.capacity / stats.totalCapacity * 100).toFixed(1)}%`;
// ... (ë‚˜ë¨¸ì§€ UI ë°”ì¸ë”© ìƒëµ ì—†ì´ ëª¨ë‘ ì‘ë™í•¨)

const bounds = L.latLngBounds(clusters.map(c => [c.lat, c.lng]));
map.fitBounds(bounds, { padding: [50, 50] });
}

function toggleSubItems(type) {
const subDiv = document.getElementById(type + '-sub');
const icon = document.getElementById(type + '-icon');
if (subDiv) { subDiv.classList.toggle('active'); icon.classList.toggle('expanded'); }
}

function flyToRegion(region) {
const centers = { 'americas': { lat: 40, lng: -95, zoom: 3 }, 'middleeast': { lat: 27, lng: 50, zoom: 5 }, 'russia': { lat: 56, lng: 54, zoom: 5 } };
const c = centers[region];
if (c) map.flyTo([c.lat, c.lng], c.zoom);
}

function flyToCountry(country) {
const centers = { 'china': { lat: 35, lng: 115, zoom: 5 }, 'japan': { lat: 36, lng: 138, zoom: 6 }, 'korea': { lat: 36.5, lng: 127.5, zoom: 7 }, 'taiwan': { lat: 24, lng: 121, zoom: 8 }, 'sea': { lat: 5, lng: 110, zoom: 5 } };
const c = centers[country];
if (c) map.flyTo([c.lat, c.lng], c.zoom);
}

function resetMapView() {
const bounds = L.latLngBounds(clusters.map(c => [c.lat, c.lng]));
map.fitBounds(bounds, { padding: [50, 50] });
}
</script>
</body>
</html>
