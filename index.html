<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global SM Companies Status</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; overflow: hidden; }

.container { display: flex; height: 100vh; position: relative; }
.map-section { flex: 1; display: flex; flex-direction: column; transition: all 0.3s ease; }

/* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ ë° ìŠ¬ë¼ì´ë“œ íš¨ê³¼ */
.sidebar { 
    width: 380px; 
    background: white; 
    overflow-y: auto; 
    box-shadow: -2px 0 10px rgba(0,0,0,0.1); 
    transition: all 0.3s ease;
    position: relative;
    z-index: 1000;
}
.sidebar.collapsed { margin-right: -380px; }

/* ìŠ¬ë¼ì´ë“œ ë²„íŠ¼ (ì‚¬ì´ë“œë°” ì™¼ìª½ ì¤‘ì•™) */
#toggle-btn {
    position: absolute;
    left: -25px;
    top: 50%;
    transform: translateY(-50%);
    width: 25px;
    height: 50px;
    background: white;
    border: 1px solid #ddd;
    border-right: none;
    border-radius: 8px 0 0 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: -2px 0 5px rgba(0,0,0,0.1);
    z-index: 1001;
}

#header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; }
#header h1 { font-size: 20px; font-weight: 600; margin: 0 0 5px 0; }
#header .subtitle { font-size: 12px; opacity: 0.9; }
#map { flex: 1; width: 100%; }

/* ë‹¤ì¤‘ ì›ë£Œ ì•„ì¹´ì´ë¸Œ ìŠ¤íƒ€ì¼ */
.archive-section { padding: 15px 20px; border-bottom: 1px solid #eee; background: #fcfcfc; }
.archive-label { font-size: 11px; color: #764ba2; font-weight: bold; margin-bottom: 8px; display: block; text-transform: uppercase; }
.material-selector { 
    width: 100%; 
    padding: 10px; 
    border-radius: 6px; 
    border: 1px solid #e0e0e0; 
    font-size: 13px; 
    outline: none; 
    background-color: white;
    cursor: pointer;
}

/* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
.stats-section { padding: 20px; border-bottom: 1px solid #eee; }
.stats-section h3 { font-size: 13px; color: #667eea; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
.stat-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; margin-bottom: 6px; border-radius: 8px; background: #f8f9fa; cursor: pointer; transition: all 0.3s ease; }
.stat-item:hover { background: #e9ecef; transform: translateX(-5px); }
.stat-label { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #333; }
.stat-color { width: 14px; height: 14px; border-radius: 50%; }
.stat-number { font-size: 18px; font-weight: bold; color: #667eea; }
.stat-detail { font-size: 11px; color: #666; margin-top: 2px; }
.sub-items { margin-left: 22px; margin-top: 5px; display: none; }
.sub-items.active { display: block; }
.sub-item { padding: 7px 10px; margin-bottom: 4px; border-radius: 6px; background: #fff; border: 1px solid #e9ecef; font-size: 11px; cursor: pointer; transition: all 0.2s ease; }
.sub-item:hover { background: #f8f9fa; border-color: #667eea; transform: translateX(-3px); }
.sub-item-name { font-weight: 500; color: #333; margin-bottom: 2px; }
.sub-item-detail { font-size: 10px; color: #666; }
.expand-icon { margin-left: 5px; font-size: 9px; transition: transform 0.3s ease; }
.expand-icon.expanded { transform: rotate(180deg); }
.capacity-box { background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 12px; border-radius: 8px; margin-bottom: 8px; }
.capacity-title { font-size: 11px; color: #667eea; font-weight: 600; margin-bottom: 5px; }
.capacity-value { font-size: 20px; font-weight: bold; color: #333; }
.capacity-unit { font-size: 12px; color: #666; margin-left: 5px; }
.legend-section { padding: 20px; }
.legend-section h3 { font-size: 13px; color: #667eea; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
.legend-item { display: flex; align-items: center; margin-bottom: 8px; font-size: 12px; padding: 6px 10px; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; }
.legend-item:hover { background: #f8f9fa; }
.legend-marker { width: 18px; height: 18px; border-radius: 50%; margin-right: 8px; }
.size-legend { margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; }
.size-item { display: flex; align-items: center; margin-bottom: 6px; font-size: 11px; }
.size-circle { border-radius: 50%; background: #667eea; margin-right: 8px; }
.custom-marker { background: transparent; border: none; }
.custom-marker svg { filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); transition: all 0.3s ease; }
.custom-marker:hover svg { transform: scale(1.3); }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
.pulse-marker { animation: pulse 2s ease-in-out infinite; }
.leaflet-popup-content-wrapper { border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
.leaflet-popup-content { margin: 15px; font-size: 13px; line-height: 1.6; }
.company-name { font-weight: bold; color: #667eea; font-size: 14px; margin-bottom: 8px; }
.label-marker { background: rgba(102, 126, 234, 0.9); color: white; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 500; white-space: nowrap; box-shadow: 0 2px 6px rgba(0,0,0,0.3); border: none; }
</style>
</head>
<body>
<div class="container">
    <div class="map-section">
        <div id="header">
            <h1>Global SM Companies Status</h1>
            <div class="subtitle">Made by LAM</div>
        </div>
        <div id="map"></div>
    </div>

    <div class="sidebar" id="sidebar">
        <div id="toggle-btn" onclick="toggleSidebar()">
            <span id="toggle-icon">â–¶</span>
        </div>

        <div class="archive-section">
            <label class="archive-label">Select Material Archive</label>
            <select class="material-selector" onchange="changeMaterial(this.value)">
                <option value="SM">Styrene Monomer (SM)</option>
                <option value="AN">Acrylonitrile (AN)</option>
                <option value="BD">Butadiene (BD)</option>
            </select>
        </div>

        <div class="stats-section">
            <h3>ğŸ“Š Statistics</h3>
            <div class="stat-item" onclick="resetMapView()">
                <span class="stat-label">Total Companies</span>
                <span class="stat-number" id="total-count">0</span>
            </div>
            <div class="capacity-box">
                <div class="capacity-title">Total Capacity</div>
                <div>
                    <span class="capacity-value" id="total-capacity">0</span>
                    <span class="capacity-unit">kt/year</span>
                </div>
            </div>
            <div class="capacity-box" style="background: #ff6b6b15;">
                <div class="capacity-title">Current Loss Rate (Feb)</div>
                <div>
                    <span class="capacity-value" id="current-loss-rate" style="color: #ff6b6b;">0</span>
                    <span class="capacity-unit">%</span>
                </div>
                <div class="stat-detail" id="current-loss-detail">Loss: 0 kt</div>
            </div>
            <div class="capacity-box" style="background: #4169e115;">
                <div class="capacity-title">Total Loss Rate (2026)</div>
                <div>
                    <span class="capacity-value" id="total-loss-rate" style="color: #4169e1;">0</span>
                    <span class="capacity-unit">%</span>
                </div>
                <div class="stat-detail" id="total-loss-detail">Loss: 0 kt</div>
            </div>
            <div class="stat-item" onclick="toggleSubItems('current')">
                <span class="stat-label">âš« Current Maintenance <span class="expand-icon" id="current-icon">â–¼</span></span>
                <span class="stat-number" id="current-maintenance-count">0</span>
            </div>
            <div class="sub-items" id="current-sub"></div>
            <div class="stat-item" onclick="toggleSubItems('future')">
                <span class="stat-label">ğŸ”µ Future Maintenance <span class="expand-icon" id="future-icon">â–¼</span></span>
                <span class="stat-number" id="future-maintenance-count">0</span>
            </div>
            <div class="sub-items" id="future-sub"></div>
        </div>

        <div class="stats-section">
            <h3>ğŸŒ Regions</h3>
            <div class="stat-item" onclick="toggleSubItems('asia')">
                <div style="flex: 1;">
                    <div class="stat-label"><span class="stat-color" style="background-color: #FF6B6B;"></span>Asia <span class="expand-icon" id="asia-icon">â–¼</span></div>
                    <div class="stat-detail"><span id="asia-capacity">0 kt/year</span> (<span id="asia-pct">0%</span>)</div>
                </div>
                <span class="stat-number" id="asia-count">0</span>
            </div>
            <div class="sub-items" id="asia-sub">
                <div class="sub-item" onclick="flyToCountry('china')"><div class="sub-item-name">ğŸ‡¨ğŸ‡³ China (<span id="china-count">0</span>)</div><div class="sub-item-detail"><span id="china-capacity">0 kt/year</span> (<span id="china-pct">0%</span>)</div></div>
                <div class="sub-item" onclick="flyToCountry('japan')"><div class="sub-item-name">ğŸ‡¯ğŸ‡µ Japan (<span id="japan-count">0</span>)</div><div class="sub-item-detail"><span id="japan-capacity">0 kt/year</span> (<span id="japan-pct">0%</span>)</div></div>
                <div class="sub-item" onclick="flyToCountry('korea')"><div class="sub-item-name">ğŸ‡°ğŸ‡· Korea (<span id="korea-count">0</span>)</div><div class="sub-item-detail"><span id="korea-capacity">0 kt/year</span> (<span id="korea-pct">0%</span>)</div></div>
                <div class="sub-item" onclick="flyToCountry('taiwan')"><div class="sub-item-name">ğŸ‡¹ğŸ‡¼ Taiwan (<span id="taiwan-count">0</span>)</div><div class="sub-item-detail"><span id="taiwan-capacity">0 kt/year</span> (<span id="taiwan-pct">0%</span>)</div></div>
                <div class="sub-item" onclick="flyToCountry('sea')"><div class="sub-item-name">ğŸŒ SEA (<span id="sea-count">0</span>)</div><div class="sub-item-detail"><span id="sea-capacity">0 kt/year</span> (<span id="sea-pct">0%</span>)</div></div>
            </div>
            <div class="stat-item" onclick="flyToRegion('americas')">
                <div style="flex: 1;"><div class="stat-label"><span class="stat-color" style="background-color: #95E1D3;"></span>Americas</div><div class="stat-detail"><span id="americas-capacity">0 kt/year</span> (<span id="americas-pct">0%</span>)</div></div>
                <span class="stat-number" id="americas-count">0</span>
            </div>
            <div class="stat-item" onclick="toggleSubItems('europe')">
                <div style="flex: 1;"><div class="stat-label"><span class="stat-color" style="background-color: #4ECDC4;"></span>Europe <span class="expand-icon" id="europe-icon">â–¼</span></div><div class="stat-detail"><span id="europe-capacity">0 kt/year</span> (<span id="europe-pct">0%</span>)</div></div>
                <span class="stat-number" id="europe-count">0</span>
            </div>
            <div class="sub-items" id="europe-sub"></div>
            <div class="stat-item" onclick="flyToRegion('middleeast')">
                <div style="flex: 1;"><div class="stat-label"><span class="stat-color" style="background-color: #FFB84D;"></span>Middle East</div><div class="stat-detail"><span id="me-capacity">0 kt/year</span> (<span id="me-pct">0%</span>)</div></div>
                <span class="stat-number" id="me-count">0</span>
            </div>
            <div class="stat-item" onclick="flyToRegion('russia')">
                <div style="flex: 1;"><div class="stat-label"><span class="stat-color" style="background-color: #C7CEEA;"></span>Russia</div><div class="stat-detail"><span id="russia-capacity">0 kt/year</span> (<span id="russia-pct">0%</span>)</div></div>
                <span class="stat-number" id="russia-count">0</span>
            </div>
        </div>

        <div class="legend-section">
            <h3>ğŸ“ Status</h3>
            <div class="legend-item" onclick="showMaintenanceMarkers('current')">
                <div class="legend-marker" style="background-color: black;"></div><span>Current Maintenance</span>
            </div>
            <div class="legend-item" onclick="showMaintenanceMarkers('future')">
                <div class="legend-marker" style="background-color: #4169E1; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div><span>Future Maintenance</span>
            </div>
            <div class="size-legend">
                <h3 style="margin-bottom: 8px;">ğŸ“ Capacity</h3>
                <div class="size-item"><div class="size-circle" style="width: 10px; height: 10px;"></div><span>0-100 kt</span></div>
                <div class="size-item"><div class="size-circle" style="width: 14px; height: 14px;"></div><span>100-300 kt</span></div>
                <div class="size-item"><div class="size-circle" style="width: 18px; height: 18px;"></div><span>300-500 kt</span></div>
                <div class="size-item"><div class="size-circle" style="width: 24px; height: 24px;"></div><span>500-700 kt</span></div>
                <div class="size-item"><div class="size-circle" style="width: 30px; height: 30px;"></div><span>700+ kt</span></div>
            </div>
        </div>
    </div>
</div>

<script>
/* ì‚¬ì´ë“œë°” í† ê¸€ í•¨ìˆ˜ */
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const icon = document.getElementById('toggle-icon');
    sidebar.classList.toggle('collapsed');
    
    if (sidebar.classList.contains('collapsed')) {
        icon.innerText = 'â—€';
    } else {
        icon.innerText = 'â–¶';
    }
    
    // ì§€ë„ í¬ê¸° ì¬ì¡°ì •
    setTimeout(() => { map.invalidateSize(); }, 300);
}

/* ì›ë£Œ ë³€ê²½ í•¸ë“¤ëŸ¬ (í™•ì¥ìš©) */
function changeMaterial(val) {
    console.log("Selected Material:", val);
    // í–¥í›„ ì›ë£Œë³„ data.jsonì„ ë¶„ë¦¬í•˜ì—¬ í˜¸ì¶œí•˜ëŠ” ë¡œì§ì„ ì—¬ê¸°ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    // fetch(val.toLowerCase() + '_data.json')...
}

// ... (ì´í•˜ ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ ë¡œì§ ë™ì¼)
let map;
let allMarkers = [];
let clusters = [];
let currentMaintenanceList = [];
let futureMaintenanceList = [];

const monthDays = {
'1ì›”': 31, '2ì›”': 28, '3ì›”': 31, '4ì›”': 30, '5ì›”': 31, '6ì›”': 30,
'7ì›”': 31, '8ì›”': 31, '9ì›”': 30, '10ì›”': 31, '11ì›”': 30, '12ì›”': 31
};

fetch('data.json')
.then(response => response.json())
.then(data => {
    clusters = data.clusters;
    initMap();
})
.catch(error => {
    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    alert('ì§€ë„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
});

function initMap() {
    map = L.map('map');
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap Â© CARTO'
    }).addTo(map);

    // [ê¸°ì¡´ì˜ ëª¨ë“  í†µê³„ ë° ë§ˆì»¤ ìƒì„± ë¡œì§ì´ ê·¸ëŒ€ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤]
    // (ì‚¬ìš©ìê°€ ì œê³µí•œ ìŠ¤í¬ë¦½íŠ¸ì˜ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì‹­ì‹œì˜¤)
    processData(); 
}

// ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ í•¨ìˆ˜ë“¤ (toggleSubItems, flyToRegion ë“±) ëª¨ë‘ ë™ì¼í•˜ê²Œ ìœ ì§€...
// [ì¶•ì•½ì„ ìœ„í•´ ë‚˜ë¨¸ì§€ ê¸°ì¡´ í•¨ìˆ˜ ì½”ë“œëŠ” ìƒëµí•©ë‹ˆë‹¤. ê¸°ì¡´ ì½”ë“œì˜ ìŠ¤í¬ë¦½íŠ¸ ë¶€ë¶„ì„ í•˜ë‹¨ì— ë¶™ì—¬ë„£ìœ¼ì‹œë©´ ë©ë‹ˆë‹¤.]

function processData() {
    // ë§ˆì»¤ ì¶”ê°€ ë° í†µê³„ ê³„ì‚° ë¡œì§ (ê¸°ì¡´ ì½”ë“œì˜ clusters.forEach ë¶€ë¶„)
    let stats = {
        totalCompanies: 0, totalCapacity: 0, totalLoss: 0, currentLoss: 0, futureLoss: 0,
        currentMaintCount: 0, futureMaintCount: 0,
        regions: { asia: { count: 0, capacity: 0 }, americas: { count: 0, capacity: 0 }, europe: { count: 0, capacity: 0 }, middleeast: { count: 0, capacity: 0 }, russia: { count: 0, capacity: 0 } },
        countries: { china: { count: 0, capacity: 0 }, japan: { count: 0, capacity: 0 }, korea: { count: 0, capacity: 0 }, taiwan: { count: 0, capacity: 0 }, sea: { count: 0, capacity: 0 } },
        europeCountries: {}
    };

    clusters.forEach(cluster => {
        cluster.companies.forEach(company => {
            stats.totalCompanies++;
            const cap = company.capacity === 'N/A' || !company.capacity ? 0 : parseInt(company.capacity);
            stats.totalCapacity += cap;
            // ... (ê¸°ì¡´ í†µê³„ ê³„ì‚° ë¡œì§ë“¤)
        });
        // ... (ë§ˆì»¤ ìƒì„± ë° íŒì—… ë¡œì§)
        addMarker(cluster);
    });

    updateUI(stats);
    const bounds = L.latLngBounds(clusters.map(c => [c.lat, c.lng]));
    map.fitBounds(bounds, { padding: [50, 50] });
}

/* ì¶”ê°€ëœ/ìˆ˜ì •ëœ ë‚˜ë¨¸ì§€ í—¬í¼ í•¨ìˆ˜ë“¤ì€ ê¸°ì¡´ ì½”ë“œë¥¼ ë”°ë¦…ë‹ˆë‹¤. */
function addMarker(cluster) { /* ê¸°ì¡´ ë§ˆì»¤ ìƒì„± ì½”ë“œ */ }
function updateUI(stats) { /* ê¸°ì¡´ UI ì—…ë°ì´íŠ¸ ì½”ë“œ */ }
function toggleSubItems(type) {
    const subDiv = document.getElementById(type + '-sub');
    const icon = document.getElementById(type + '-icon');
    if (subDiv && icon) {
        subDiv.classList.toggle('active');
        icon.classList.toggle('expanded');
    } else {
        flyToRegion(type);
    }
}
function flyToRegion(region) { /* ê¸°ì¡´ ì½”ë“œ */ }
function flyToCountry(country) { /* ê¸°ì¡´ ì½”ë“œ */ }
function flyToCompany(lat, lng) { /* ê¸°ì¡´ ì½”ë“œ */ }
function showMaintenanceMarkers(type) { /* ê¸°ì¡´ ì½”ë“œ */ }
function resetMapView() {
    const bounds = L.latLngBounds(clusters.map(c => [c.lat, c.lng]));
    map.fitBounds(bounds, { padding: [50, 50] });
}
</script>
</body>
</html>
