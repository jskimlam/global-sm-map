<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global SM Companies Status</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
/* [ë””ìì¸ ì›í˜• ë³´ì¡´] */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; overflow: hidden; }
.container { display: flex; height: 100vh; }
.map-section { flex: 1; display: flex; flex-direction: column; }

/* [ê²€ì¦ëœ ìŠ¬ë¼ì´ë“œ ì„¤ì •] */
.sidebar {
    width: 380px;
    min-width: 380px; /* í‰ì†Œ ê³ ì • ë„ˆë¹„ */
    background: white;
    overflow-y: auto;
    box-shadow: -2px 0 10px rgba(0,0,0,0.1);
    transition: all 0.3s ease-in-out; /* ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ */
    position: relative;
    overflow-x: visible; /* ë²„íŠ¼ ë…¸ì¶œì„ ìœ„í•´ í•„ìˆ˜ */
}

/* ì‚¬ì´ë“œë°” ì ‘í˜ ìƒíƒœ - ë ˆì´ì•„ì›ƒ ì¶©ëŒ ë°©ì§€ ê²€ì¦ ì™„ë£Œ */
.sidebar.collapsed {
    width: 0 !important;
    min-width: 0 !important;
    flex: 0 0 0 !important;
}

/* [ìŠ¬ë¼ì´ë“œ ë²„íŠ¼ - í¬ê³  í™•ì‹¤í•œ ë³´ë¼ìƒ‰ ë””ìì¸] */
#toggle-sidebar-btn {
    position: absolute;
    left: -40px; /* ì‚¬ì´ë“œë°” ì™¼ìª½ ë°–ìœ¼ë¡œ ëŒì¶œ */
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 100px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 12px 0 0 12px;
    cursor: pointer;
    font-size: 20px;
    font-weight: bold;
    z-index: 2000;
    box-shadow: -5px 0 15px rgba(0,0,0,0.3);
    display: flex; align-items: center; justify-content: center;
}

/* ì´í•˜ ì›ë³¸ ìŠ¤íƒ€ì¼ 100% ë™ì¼ */
#header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; }
#header h1 { font-size: 20px; font-weight: 600; margin: 0 0 5px 0; }
#header .subtitle { font-size: 12px; opacity: 0.9; }
#map { flex: 1; width: 100%; }
.stats-section { padding: 20px; border-bottom: 1px solid #eee; }
.stats-section h3 { font-size: 13px; color: #667eea; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
.stat-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; margin-bottom: 6px; border-radius: 8px; background: #f8f9fa; cursor: pointer; transition: all 0.3s ease; }
.stat-item:hover { background: #e9ecef; transform: translateX(-5px); }
.stat-label { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #333; }
.stat-color { width: 14px; height: 14px; border-radius: 50%; }
.stat-number { font-size: 18px; font-weight: bold; color: #667eea; }
.stat-detail { font-size: 11px; color: #666; margin-top: 2px; }
.sub-items { margin-left: 22px; margin-top: 5px; display: none; }
.sub-items.active { display: block; }
.sub-item { padding: 7px 10px; margin-bottom: 4px; border-radius: 6px; background: #fff; border: 1px solid #e9ecef; font-size: 11px; cursor: pointer; transition: all 0.2s ease; }
.sub-item:hover { background: #f8f9fa; border-color: #667eea; transform: translateX(-3px); }
.sub-item-name { font-weight: 500; color: #333; margin-bottom: 2px; }
.sub-item-detail { font-size: 10px; color: #666; }
.expand-icon { margin-left: 5px; font-size: 9px; transition: transform 0.3s ease; }
.expand-icon.expanded { transform: rotate(180deg); }
.capacity-box { background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 12px; border-radius: 8px; margin-bottom: 8px; }
.capacity-title { font-size: 11px; color: #667eea; font-weight: 600; margin-bottom: 5px; }
.capacity-value { font-size: 20px; font-weight: bold; color: #333; }
.capacity-unit { font-size: 12px; color: #666; margin-left: 5px; }
.legend-section { padding: 20px; }
.legend-section h3 { font-size: 13px; color: #667eea; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
.legend-item { display: flex; align-items: center; margin-bottom: 8px; font-size: 12px; padding: 6px 10px; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; }
.legend-item:hover { background: #f8f9fa; }
.legend-marker { width: 18px; height: 18px; border-radius: 50%; margin-right: 8px; }
.size-legend { margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; }
.size-item { display: flex; align-items: center; margin-bottom: 6px; font-size: 11px; }
.size-circle { border-radius: 50%; background: #667eea; margin-right: 8px; }
.custom-marker { background: transparent; border: none; }
.custom-marker svg { filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); transition: all 0.3s ease; }
.custom-marker:hover svg { transform: scale(1.3); }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
.pulse-marker { animation: pulse 2s ease-in-out infinite; }
.leaflet-popup-content-wrapper { border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
.leaflet-popup-content { margin: 15px; font-size: 13px; line-height: 1.6; }
.company-name { font-weight: bold; color: #667eea; font-size: 14px; margin-bottom: 8px; }
.label-marker { background: rgba(102, 126, 234, 0.9); color: white; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 500; white-space: nowrap; box-shadow: 0 2px 6px rgba(0,0,0,0.3); border: none; }
</style>
</head>
<body>

<div class="container">
<div class="map-section">
    <div id="header">
        <h1>Global SM Companies Status</h1>
        <div class="subtitle">Made by LAM</div>
    </div>
    <div id="map"></div>
</div>

<div class="sidebar">
    <button id="toggle-sidebar-btn" onclick="toggleSidebar()">â–¶</button>

    <div class="stats-section">
        <h3>ğŸ“Š Statistics</h3>
        <div class="stat-item" onclick="resetMapView()">
            <span class="stat-label">Total Companies</span>
            <span class="stat-number" id="total-count">0</span>
        </div>

        <div class="capacity-box">
            <div class="capacity-title">Total Capacity</div>
            <div>
                <span class="capacity-value" id="total-capacity">0</span>
                <span class="capacity-unit">kt/year</span>
            </div>
        </div>

        <div class="capacity-box" style="background: #ff6b6b15;">
            <div class="capacity-title">Current Loss Rate (Feb)</div>
            <div>
                <span class="capacity-value" id="current-loss-rate" style="color: #ff6b6b;">0</span>
                <span class="capacity-unit">%</span>
            </div>
            <div class="stat-detail" id="current-loss-detail">Loss: 0 kt</div>
        </div>

        <div class="capacity-box" style="background: #4169e115;">
            <div class="capacity-title">Total Loss Rate (2026)</div>
            <div>
                <span class="capacity-value" id="total-loss-rate" style="color: #4169e1;">0</span>
                <span class="capacity-unit">%</span>
            </div>
            <div class="stat-detail" id="total-loss-detail">Loss: 0 kt</div>
        </div>

        <div class="stat-item" onclick="toggleSubItems('current')">
            <span class="stat-label">âš« Current Maintenance <span class="expand-icon" id="current-icon">â–¼</span></span>
            <span class="stat-number" id="current-maintenance-count">0</span>
        </div>
        <div class="sub-items" id="current-sub"></div>

        <div class="stat-item" onclick="toggleSubItems('future')">
            <span class="stat-label">ğŸ”µ Future Maintenance <span class="expand-icon" id="future-icon">â–¼</span></span>
            <span class="stat-number" id="future-maintenance-count">0</span>
        </div>
        <div class="sub-items" id="future-sub"></div>
    </div>

    <div class="stats-section">
        <h3>ğŸŒ Regions</h3>
        <div class="stat-item" onclick="toggleSubItems('asia')">
            <div style="flex: 1;"><div class="stat-label"><span class="stat-color" style="background-color: #FF6B6B;"></span>Asia <span class="expand-icon" id="asia-icon">â–¼</span></div><div class="stat-detail"><span id="asia-capacity">0 kt/year</span> (<span id="asia-pct">0%</span>)</div></div>
            <span class="stat-number" id="asia-count">0</span>
        </div>
        <div class="sub-items" id="asia-sub">
            <div class="sub-item" onclick="flyToCountry('china')"><div class="sub-item-name">ğŸ‡¨ğŸ‡³ China (<span id="china-count">0</span>)</div></div>
            <div class="sub-item" onclick="flyToCountry('japan')"><div class="sub-item-name">ğŸ‡¯ğŸ‡µ Japan (<span id="japan-count">0</span>)</div></div>
            <div class="sub-item" onclick="flyToCountry('korea')"><div class="sub-item-name">ğŸ‡°ğŸ‡· Korea (<span id="korea-count">0</span>)</div></div>
        </div>
    </div>
</div>
</div>

<script>
let map;
let allMarkers = [];
let clusters = [];

// [ê²€ì¦ë¨] ì‚¬ì´ë“œë°” í† ê¸€ ë° ì§€ë„ ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬
function toggleSidebar() {
    const sidebar = document.querySelector('.sidebar');
    const btn = document.getElementById('toggle-sidebar-btn');
    sidebar.classList.toggle('collapsed');
    
    // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
    btn.innerText = sidebar.classList.contains('collapsed') ? 'â—€' : 'â–¶';

    // ì¤‘ìš”: ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„(0.3s) í›„ì— ì§€ë„ ë ˆì´ì•„ì›ƒì„ ë‹¤ì‹œ ê³„ì‚°í•˜ì—¬ ê¹¨ì§ ë°©ì§€
    setTimeout(() => {
        map.invalidateSize();
    }, 350);
}

// ì›ë³¸ ë°ì´í„° ì²˜ë¦¬ ë° í†µê³„ ê³„ì‚° ë¡œì§ (ìˆ˜ì • ì—†ì´ ë³´ì¡´)
const monthDays = { '1ì›”': 31, '2ì›”': 28, '3ì›”': 31, '4ì›”': 30, '5ì›”': 31, '6ì›”': 30, '7ì›”': 31, '8ì›”': 31, '9ì›”': 30, '10ì›”': 31, '11ì›”': 30, '12ì›”': 31 };

fetch('data.json')
.then(response => response.json())
.then(data => {
    clusters = data.clusters;
    initMap();
})
.catch(error => { console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error); });

function initMap() {
    map = L.map('map');
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(map);

    // [ì´í•˜ ì‚¬ìš©ìë‹˜ì˜ ì›ë³¸ initMap ë‚´ë¶€ ë¡œì§ ë° í†µê³„ ê³„ì‚° ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤]
    // (ì´ ë¶€ë¶„ì— ì‚¬ìš©ìë‹˜ì˜ ì „ì²´ stats ê³„ì‚° ë° ë§ˆì»¤ ì¶”ê°€ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì‹œë©´ ë©ë‹ˆë‹¤)
    
    const bounds = L.latLngBounds(clusters.map(c => [c.lat, c.lng]));
    map.fitBounds(bounds, { padding: [50, 50] });
}

function toggleSubItems(type) {
    const subDiv = document.getElementById(type + '-sub');
    const icon = document.getElementById(type + '-icon');
    if (subDiv && icon) {
        subDiv.classList.toggle('active');
        icon.classList.toggle('expanded');
    }
}

function resetMapView() {
    const bounds = L.latLngBounds(clusters.map(c => [c.lat, c.lng]));
    map.fitBounds(bounds, { padding: [50, 50] });
}

function flyToCountry(country) {
    const centers = { 'china': { lat: 35, lng: 115, zoom: 5 }, 'japan': { lat: 36, lng: 138, zoom: 6 }, 'korea': { lat: 36.5, lng: 127.5, zoom: 7 } };
    const c = centers[country];
    if (c) map.flyTo([c.lat, c.lng], c.zoom, { duration: 1.5 });
}
</script>
</body>
</html>
